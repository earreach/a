<input name="captcha" id="captcha" type="text" size="6" placeholder="验证码" class="input-captcha" title="请填写右侧图片上的数字和字母"/> &nbsp; <img src="{DT_PATH}api/captcha.php?action=image" title="看不清楚验证码?请点击刷新&#10;字母不区分大小写" alt="" align="absmiddle" id="captchapng" onclick="reloadcaptcha();" style="cursor:pointer;"/><span id="ccaptcha"></span>
<script type="text/javascript">
function reloadcaptcha() {
	Dd('captchapng').src = '{DT_PATH}api/captcha.php?action=image&refresh='+Math.random();
	Dd('ccaptcha').innerHTML = '';
	Dd('captcha').value = '';
}
function checkcaptcha(s) {
	s = $.trim(s);
	if(!is_captcha(s)) return;
	$.post(AJPath, 'action=captcha&captcha='+s,
		function(data) {
			if(data == '0') {
				Dd('ccaptcha').innerHTML = '&nbsp;&nbsp;<img src="{DT_STATIC}image/check-ok.png" align="absmiddle"/>';
			} else {
				Dd('captcha').focus;
				Dd('ccaptcha').innerHTML = '&nbsp;&nbsp;<img src="{DT_STATIC}image/check-ko.png" align="absmiddle"/>';
			}
		}
	);
}
function is_captcha(v) {
	if(v.match(/^[a-z0-9A-Z]{1,}$/)) {
		return v.match(/^[a-z0-9A-Z]{4,}$/);
	} else {
		return v.length > 1;
	}
}
$(function() {
	$('#captcha').bind('keyup blur', function() {
		checkcaptcha($('#captcha').val());
	});
});
</script>