{template 'header', 'member'}
<div class="menu">
<table cellpadding="0" cellspacing="0">
<tr>
<td class="tab" id="add"><a href="?action=list"><span>广告预定</span></a></td>
<td class="tab" id="s3"><a href="?action=index"><span>已通过({$nums[3]})</span></a></td>
<td class="tab" id="s2"><a href="?status=2"><span>审核中({$nums[2]})</span></a></td>
</tr>
</table>
</div>
{if $action == 'add'}
{load('webuploader.min.js')}
{load('url2video.js')}
{load('player.js')}
<form method="post" action="?" id="dform" onsubmit="return check();">
<input type="hidden" name="action" value="{$action}"/>
<input type="hidden" name="pid" value="{$pid}"/>
<input type="hidden" name="price" value="{$p[price]}" id="price"/>
<table cellpadding="10" cellspacing="1" class="tb">
<tr>
<td class="tl">广告位名称</td>
<td class="tr"><strong>{$p[name]}</strong></td>
</tr>
<tr>
<td class="tl">广告位类型</td>
<td class="tr">{$TYPE[$typeid]}</td>
</tr>
{if $p[introduce]}
<tr>
<td class="tl">广告位介绍</td>
<td class="tr">{$p[introduce]}</td>
</tr>
{/if}
{if $p[width] && $p[height]}
<tr>
<td class="tl">广告位大小</td>
<td class="tr">{$p[width]}px X {$p[height]}px</td>
</tr>
{/if}
{if $typeid == 1}
<tr>
<td class="tl"><span class="f_red">*</span> 广告代码</td>
<td class="tr"><textarea name="post[code]" id="code" style="width:98%;height:50px;overflow:visible;"></textarea><br/><span id="dcode" class="f_red"></span></td>
</tr>
{elseif $typeid == 2}
<tr>
<td class="tl"><span class="f_red">*</span> 链接文字</td>
<td class="tr f_gray"><input type="text" size="30" name="post[text_name]" id="text_name"/> <span id="dtext_name" class="f_red"></span></td>
</tr>
<tr>
<td class="tl"><span class="f_red">*</span> 链接地址</td>
<td class="tr"><input type="text" size="70" name="post[text_url]" id="text_url" value=""/> <span id="dtext_url" class="f_red"></span></td>
</tr>
<tr>
<td class="tl">标题提示</td>
<td class="tr"><input type="text" size="70" name="post[text_title]" id="text_title"/></td>
</tr>
{elseif $typeid == 3 || $typeid == 5}
<tr>
<td class="tl"><span class="f_red">*</span> 广告图片</td>
<td class="tr">
<input type="hidden" name="post[image_src]" id="thumb" value=""/>
<div class="thumbu">
<div><img src="{DT_STATIC}image/upload-image.png" id="pthumb" onclick="if(this.src.indexOf('upload-image.png') == -1){_preview(this.src, 1);}else{Dthumb({$moduleid},{$p[width]},{$p[height]}, Dd('thumb').value,true);}"/></div>
<p><img src="{DT_STATIC}image/ico-upl.png" width="11" height="11" title="上传" onclick="Dthumb({$moduleid},{$p[width]},{$p[height]}, Dd('thumb').value,true);"/><img src="{DT_STATIC}image/ico-del.png" width="11" height="11" title="删除" onclick="Dd('thumb').value='';Dd('pthumb').src='{DT_STATIC}image/upload-image.png';"/></p>
</div><span id="dthumb" class="f_red"></span>
</td>
</tr>
<tr>
<td class="tl">链接地址</td>
<td class="tr"><input type="text" size="70" name="post[image_url]" id="{DT_STATIC}member_url" value=""/> <span id="dimage_url" class="f_red"></span></td>
</tr>
<tr>
<td class="tl">标题提示</td>
<td class="tr"><input type="text" size="70" name="post[image_alt]"/></td>
</tr>			
{elseif $typeid == 4}
<tr>
<td class="tl"><span class="f_red">*</span> 视频地址</td>
<td class="tr">{template 'upload-video', 'chip'}</td>
</tr>
<tr>
<td class="tl">自动播放</td>
<td class="tr">
<label><input type="radio" name="post[video_auto]" value="1" checked/> 是</label>&nbsp;&nbsp;
<label><input type="radio" name="post[video_auto]" value="0"/> 否</label>
</td>
</tr>
<tr>
<td class="tl">循环播放</td>
<td class="tr">
<label><input type="radio" name="post[video_loop]" value="1" checked/> 是</label>&nbsp;&nbsp;
<label><input type="radio" name="post[video_loop]" value="0"/> 否</label>
</td>
</tr>
<tr>
<td class="tl">链接地址</td>
<td class="tr"><input type="text" size="70" name="post[video_url]" value=""/></td>
</tr>
{elseif $typeid == 6}
<tr>
<td class="tl">所属模块</td>
<td class="tr"><a href="{$MODULE[$p[moduleid]][linkurl]}" target="_blank" class="t">{$MODULE[$p[moduleid]][name]}</a></td>
</tr>
<tr>
<td class="tl">所属分类</td>
<td class="tr">{ajax_category_select('post[catid]', '请选择', $catid, $p[moduleid])}</td>
</tr>
<tr>
<td class="tl">关键词</td>
<td class="tr"><input type="text" size="30" name="post[word]" id="word" value="{$kw}"/> <span id="dword" class="f_red"></span></td>
</tr>
{if $p[moduleid] == 4}
<input type="hidden" name="post[key_id]" id="key_id" value="{$_userid}"/>
{else}
<tr>
<td class="tl"><span class="f_red">*</span> 信息ID</td>
<td class="tr"><input type="text" size="10" name="post[key_id]" id="key_id" onfocus="select_item({$p[moduleid]}, 'member');"/> &nbsp; <img src="{DT_STATIC}image/ico-sort.png" width="11" height="11" title="选择信息" class="c_p" onclick="select_item({$p[moduleid]}, 'member');"/> <span id="dkey_id" class="f_red"></span></td>
</tr>
{/if}
{elseif $typeid == 7}
<tr>
<td class="tl">所属模块</td>
<td class="tr"><a href="{$MODULE[$p[moduleid]][linkurl]}" target="_blank" class="t">{$MODULE[$p[moduleid]][name]}</a></td>
</tr>
<tr>
<td class="tl">所属分类</td>
<td class="tr">{ajax_category_select('post[catid]', '请选择', 0, $p[moduleid])}</td>
</tr>
<tr>
<td class="tl">关键词</td>
<td class="tr"><input type="text" size="30" name="post[word]"/></td>
</tr>
<tr>
<td class="tl"><span class="f_red">*</span> 广告代码</td>
<td class="tr"><textarea name="post[code]" id="code" style="width:98%;height:50px;overflow:visible;font-family:Fixedsys,verdana;"></textarea><br/><span id="dcode" class="f_red"></span></td>
</tr>
{/if}
<tr>
<td class="tl"><span class="f_red">*</span> 开始日期</td>
<td class="tr">{dcalendar('post[fromtime]', $fromdate)} <span id="dpostfromtime" class="f_red"></span></td>
</tr>
<tr>
<td class="tl"><span class="f_red">*</span> 购买时长</td>
<td class="tr f_gray">
<select name="month" id="month"{if $prices} onchange="CA();"{/if}>
{loop $months $m}<option value="{$m}">{$m}</option>{/loop}
</select>
<span id="pname">月</span>
</td>
</tr>
{if $prices}
<tr>
<td class="tl">广告价格</td>
<td class="tr">
{if count($prices) == 1}
	{loop $prices $kk $vv}
	<input type="hidden" name="ptype" id="ptype" value="m1" data-price="{$vv}" data-name="{$PTYPE[$kk]}"/>
	<span class="f_red">{if $currency == 'money'}{$DT[money_sign]}{/if}{$p[price]}</span> {$unit}/{$PTYPE[$kk]}
	{/loop}
{else}
	<select name="ptype" id="ptype" onchange="CP();">
	{loop $prices $kk $vv}
	<option value="{$kk}" data-price="{$vv}" data-name="{$PTYPE[$kk]}">{$vv}{$unit}/{$PTYPE[$kk]}</option>
	{/loop}
	</select>
{/if}
</td>
</tr>
<tr>
<td class="tl">应付总价</td>
<td class="tr">{if $currency == 'money'}<span class="f_price">{$DT[money_sign]}</span>{/if}<span id="money" class="f_price px16"></span> {$unit}</td>
</tr>
{if $currency == 'money'}
<tr>
<td class="tl">账户余额</td>
<td class="tr"><span class="f_blue">{$DT[money_sign]}{$_money}</span> {$DT[money_unit]}&nbsp;&nbsp;<a href="charge.php?action=pay" target="_blank" class="t">[充值]</a></td>
</tr>
<tr id="payword">
<td class="tl"><span class="f_red">*</span> 支付密码</td>
<td class="tr">{template 'payword', 'chip'} <span id="dpassword" class="f_red"></span></td>
</tr>
{else}
<tr>
<td class="tl">{$DT[credit_name]}余额</td>
<td class="tr"><span class="f_blue">{$_credit}</span> {$DT[credit_unit]}&nbsp;&nbsp;<a href="credit.php?action=buy" target="_blank" class="t">[购买]</a></td>
</tr>
{/if}
{/if}
<tr>
<td class="tl">备注事项</td>
<td class="tr"><input type="text" size="70" name="post[note]"/></td>
</tr>
<tr>
<td class="tl"> </td>
<td class="tr">
<input type="submit" name="submit" value="{if $prices}确定购买{else}预定广告{/if}" class="btn_g"/> &nbsp; 
<input type="button" value="重新选择" class="btn" onclick="Go('?action=list');"/>
</td>
</tr>
</table>
</form>

{load('clear.js')}
<script type="text/javascript">
var money;
function CA() {
	money = Dd('price').value*Dd('month').value;
	Dd('money').innerHTML = money;
	if(money > {$DT[quick_pay]}){$('#payword').show();}else{$('#payword').hide();}
}
function CP() {
	{if count($prices) > 1}
	$('#price').val($('#ptype').find('option:selected').attr('data-price'));
	$('#pname').html($('#ptype').find('option:selected').attr('data-name'));
	{/if}
	CA();
}
function check() {
	var p = Dd('price').value;
{if $currency == 'money'}
	if(p*Dd('month').value > {$_money}) {
		alert('帐户余额不足，请先充值');
		return false;
	}
{else}
	if(p*Dd('month').value > {$_credit}) {
		alert('您的{$DT[credit_name]}不足，请先购买');
		return false;
	}
{/if}
{if $typeid == 1 || $typeid == 7}
	if(Dd('code').value.length < 5) {
		Dmsg('请填写广告代码', 'code');
		return false;
	}
{elseif $typeid == 2}
	if(Dd('text_name').value.length < 2) {
		Dmsg('请填写链接文字', 'text_name');
		return false;
	}
	if(Dd('text_url').value.length < 10) {
		Dmsg('请填写链接地址', 'text_url');
		return false;
	}
{elseif $typeid == 3 || $typeid == 5}
	if(Dd('thumb').value.length < 10) {
		Dmsg('请填写图片地址或上传图片', 'thumb');
		return false;
	}
{elseif $typeid == 4}
	if(Dd('video').value.length < 10) {
		Dmsg('请填写视频地址', 'video');
		return false;
	}
{elseif $typeid == 6}
	if(Dd('key_id').value.length < 1) {
		Dmsg('请填写信息ID', 'key_id');
		return false;
	}
{/if}
	if(Dd('postfromtime').value.replace(/-/g, '') < '{$fromdate}'.replace(/-/g, '')) {
		Dd('postfromtime').value = '{$fromdate}';
		Dd('postfromtime').focus();
		Dmsg('开始投放日期需从{$fromdate}开始', 'postfromtime');
		return false;
	}
{if $prices && $currency == 'money'}
	if(money > {$DT[quick_pay]} && Dd('password').value.length < 6) {
		Dmsg('请填写支付密码', 'password');
		return false;
	}
{/if}
}
{if $prices}
$(function(){
	CP();
});
{/if}
</script>
<script type="text/javascript">s('ad');m('add');</script>


{elseif $action == 'list'}
<div class="ls">
<table cellpadding="10" cellspacing="0" class="tb">
<tr>
<th width="130">编号</th>
<th>广告位名称</th>
<th>广告类型</th>
<th>规格(px)</th>
<th>价格/月</th>
<th>示意图</th>
{if $EXT[ad_buy]}<th width="60">预定</th>{/if}
</tr>
{loop $lists $k $v}
<tr align="center" title="{$v[introduce]}">
<td id="a_{$v[pid]}">A{$v[pid]}</td>
<td><a href="{$adurl}{rewrite('index.php?pid='.$v['pid'])}" target="_blank" class="t">{$v[name]}</a></td>
<td>{$v[typename]}</td>
<td class="f_gray">{$v[width]} x {$v[height]}</td>
<td>
{if $v[prices]}
	{if count($v[prices]) == 1}
	{loop $v[prices] $kk $vv}
	<span class="f_orange">{$vv}{$unit}/{$PTYPE[$kk]}</span>
	{/loop}
	{else}
	<select>
	{loop $v[prices] $kk $vv}
	<option>{$vv}{$unit}/{$PTYPE[$kk]}</option>
	{/loop}
	</select>
	{/if}
{else}
	<span class="f_gray">面议</span>
{/if}
</td>
<td class="f_gray">{if $v[thumb]}<a href="javascript:;" onclick="_preview('{$v[thumb]}');" title="点击查看大图" class="t">查看</a>{else}暂无{/if}</td>
{if $EXT[ad_buy]}<td><a href="?action=add&pid={$v[pid]}" class="t">{if $v[prices]}购买{else}预定{/if}</a></td>{/if}
</tr>
{/loop}
</table>
</div>
<div class="pages">{$pages}</div>
<script type="text/javascript">s('ad');m('add');</script>


{else}
<div class="ls">
<table cellpadding="10" cellspacing="0" class="tb">
<tr>
<th width="150">广告类型</th>
<th>广告名称</th>
<th>出价</th>
<th>开始日期</th>
<th>结束日期</th>
<th>剩余(天)</th>
<th>投放状态</th>
<th width="150">申请时间</th>
<th width="60">预览</th>
</tr>
{loop $lists $k $v}
<tr align="center" title="简介:{$v[introduce]}">
<td>{$TYPE[$v[typeid]]}</td>
<td align="left">&nbsp;&nbsp;<a href="{$adurl}{rewrite('index.php?aid='.$v['aid'])}" target="_blank" class="t">{$v[title]}</a></td>
<td class="f_red">{$v[amount]}{if $v[currency] == 'money'}{$DT[money_unit]}{else}{$DT[credit_unit]}{/if}</td>
<td>{timetodate($v[fromtime], 3)}</td>
<td>{timetodate($v[totime], 3)}</td>
<td{if $v[days]<5} class="f_red"{/if}>{$v[days]}</td>
<td>{$v[process]}</td>
<td class="f_gray">{timetodate($v[addtime], 5)}</td>
<td><a href="{$adurl}{rewrite('index.php?aid='.$v['aid'])}" target="_blank" class="t">预览</a></td>
</tr>
{/loop}
</table>
</div>
<div class="pages">{$pages}</div>
<script type="text/javascript">s('ad');m('s{$status}');</script>
{/if}
{template 'footer', 'member'}