{template 'header', 'member'}
{load('member.css')}
<div class="menu">
<table cellpadding="0" cellspacing="0">
<tr>
<td class="tab" id="add"><a href="?action=find"><span>添加好友</span></a></td>
<td class="tab" id="s3"><a href="?action=index"><span>我的好友</span></a></td>
<td class="tab" id="list"><a href="?action=list"><span>黑名单</span></a></td>
<td class="tab"><a href="javascript:;" onclick="Dwidget('type.php?item=friend', '好友分类', 1000, 600);"><span>好友分类</span></a></td>
</tr>
</table>
</div>
{if $action == 'find'}
<form action="?" id="search">
<input type="hidden" name="action" value="{$action}"/>
<div class="tt">
<input type="text" name="kw" value="{$kw}" placeholder="会员名/昵称/手机/邮箱" title="会员名/昵称手机/邮箱" style="width:240px;border-radius:6px;border:#18A117 1px solid;outline:none;"/>&nbsp;
<input type="submit" value=" 查 找 " class="btn_g"/>&nbsp;
<input type="button" value=" 重 搜 " class="btn" onclick="Go('?action={$action}');"/>
</div>
</form>
{if $lists}
<table cellpadding="10" cellspacing="0" class="tb">
<tr>
<th width="60">头像</th>
<th>会员</th>
<th width="80">粉丝</th>
<th width="80">关注</th>
{if $MG[chat] && $DT[im_web]}<th width="80">聊天</th>{/if}
{if $MG[inbox_limit]>-1}<th width="80">私信</th>{/if}
<th width="40">添加</th>
</tr>
{loop $lists $k $v}
<tr align="center">
<td><a href="{userurl($v[username], 'file=space')}" target="_blank"><img src="{useravatar($v[username])}" width="48" height="48" class="avatar"/></a><i class="userinfo-v{$v[validate]}" title="{valid_name($v[validate])}"></i></td>
<td align="left">
<a href="?action=add&username={$v[username]}" title="加为好友">{$v[passport]}</a>
<div class="f_gray lh32">{if $v[sign]}{$v[sign]}{else}没有留下签名~~{/if}</div>
</td>
<td>{numtoread($v[fans])}</td>
<td>{numtoread($v[follows])}</td>
{if $MG[chat] && $DT[im_web]}<td>{im_web($v[username])}</td>{/if}
{if $MG[inbox_limit]>-1}<td><a href="javascript:;" onclick="Dwidget('message.php?action=send&touser={$v[username]}', '发送信件');"><img src="{DT_STATIC}image/msg.gif" title="发送站内信" align="absmiddle"/></a></td>{/if}
<td><a href="?action=add&username={$v[username]}"><img width="16" height="16" src="{DT_STATIC}image/ico-fadd.png" title="加为好友" alt=""/></a></td>
</tr>
{/loop}
</table>
{elseif $kw}
<div style="padding:24px 12px;color:#999999;">未找到相关用户</div>
{/if}
<script type="text/javascript">s('friend');m('add');</script>
{elseif $action == 'apply'}
<form method="post" action="?">
<input type="hidden" name="action" value="add"/>
<input type="hidden" name="username" value="{$username}"/>
<table cellpadding="10" cellspacing="1" class="tb">
<tr>
<td class="tl">申请好友</td>
<td class="tr">
	<div class="list-img">
	<a href="{userurl($user[username], 'file=space')}" rel="external"><img src="{useravatar($user[username], 'large')}" width="48" height="48" class="avatar"/><i class="userinfo-v{$user[validate]}" title="{valid_name($user[validate])}"></i></a>
	<ul>
	<li>{if $DT[follow]}<span class="f_r">{numtoread($user[fans])}粉丝</span>{/if}<a href="{userurl($user[username], 'file=space')}" rel="external"><strong>{$user[passport]}</strong></a></li>
	<li><span>{if $user[sign]}{$user[sign]}{else}没有留下签名~~{/if}</span></li>
	</ul>
	</div>
</td>
</tr>
<tr>
<td class="tl">申请原因</td>
<td class="tr"><textarea name="reason" id="reason" style="width:200px;height:80px;" maxlength="300" placeholder="">我是{$_passport}</textarea></td>
</tr>
</table>
<div class="sbt">
<input type="submit" name="submit" value="申 请" class="btn_g"/> &nbsp; &nbsp;<input type="button" value=" 取 消 " class="btn" onclick="history.back(-1);"/>
</div>
</form>
<script type="text/javascript">s('friend');m('add');</script>
{elseif $action == 'refuse'}
<form method="post" action="?">
<input type="hidden" name="action" value="add"/>
<input type="hidden" name="auth" value="{$auth}"/>
<table cellpadding="10" cellspacing="1" class="tb">
<tr>
<td class="tl">拒绝好友</td>
<td class="tr">
	<div class="list-img">
	<a href="{userurl($user[username], 'file=space')}" rel="external"><img src="{useravatar($user[username], 'large')}" width="48" height="48" class="avatar"/><i class="userinfo-v{$user[validate]}" title="{valid_name($user[validate])}"></i></a>
	<ul>
	<li>{if $DT[follow]}<span class="f_r">{numtoread($user[fans])}粉丝</span>{/if}<a href="{userurl($user[username], 'file=space')}" rel="external"><strong>{$user[passport]}</strong></a></li>
	<li><span>{if $user[sign]}{$user[sign]}{else}没有留下签名~~{/if}</span></li>
	</ul>
	</div>
</td>
</tr>
<tr>
<td class="tl">拒绝理由</td>
<td class="tr"><textarea name="reason" id="reason" style="width:200px;height:80px;" maxlength="300"></textarea></td>
</tr>
</table>
<div class="sbt">
<input type="submit" name="submit" value="拒 绝" class="btn_g"/> &nbsp; &nbsp;<input type="button" value=" 取 消 " class="btn" onclick="history.back(-1);"/>
</div>
</form>
<script type="text/javascript">s('friend');m('add');</script>
{elseif $action == 'edit'}
<form method="post" action="?">
<input type="hidden" name="action" value="{$action}"/>
<input type="hidden" name="itemid" value="{$itemid}"/>
<input type="hidden" name="forward" value="{$forward}"/>
<table cellpadding="10" cellspacing="1" class="tb">
{if $user}
<tr>
<td class="tl">会员</td>
<td class="tr">
	<div class="list-img">
	<a href="{userurl($user[username], 'file=space')}" rel="external"><img src="{useravatar($user[username], 'large')}" width="48" height="48" class="avatar"/><i class="userinfo-v{$user[validate]}" title="{valid_name($user[validate])}"></i></a>
	<ul>
	<li>{if $DT[follow]}<span class="f_r">{numtoread($user[fans])}粉丝</span>{/if}<a href="{userurl($user[username], 'file=space')}" rel="external"><strong>{$user[passport]}</strong></a></li>
	<li><span>{if $user[sign]}{$user[sign]}{else}没有留下签名~~{/if}</span></li>
	</ul>
	</div>
</td>
</tr>
{/if}
<tr>
<td class="tl">分类</td>
<td class="tr"><span id="type_box">{$type_select}</span>&nbsp; <a href="javascript:var type_item='friend-{$_userid}',type_name='post[typeid]',type_default='{$L[default_type]}',type_id={$typeid},type_interval=setInterval('type_reload()',500);Dwidget('type.php?item=friend', '好友分类', 1000, 600);" ><img src="{DT_STATIC}image/ico-add.png" width="11" height="11" title="管理分类"/></a></td>
</tr>
<tr>
<td class="tl">别名</td>
<td class="tr"><input type="text" size="20" name="post[alias]" id="alias" value="{$alias}"/></td>
</tr>
<tr>
<td class="tl">姓名</td>
<td class="tr"><input type="text" size="20" name="post[truename]" id="truename" value="{$truename}"/> <span id="dtruename" class="f_red"></span></td>
</tr>
<tr>
<td class="tl">公司</td>
<td class="tr"><input type="text" size="40" name="post[company]" id="company" value="{$company}"/></td>
</tr>
<tr>
<td class="tl">职位</td>
<td class="tr"><input type="text" size="20" name="post[career]" id="career" value="{$career}"/></td>
</tr>
<tr>
<td class="tl">手机</td>
<td class="tr"><input type="text" size="20" name="post[mobile]" id="mobile" value="{$mobile}"/></td>
</tr>
<tr>
<td class="tl">电话</td>
<td class="tr"><input type="text" size="20" name="post[telephone]" id="telephone" value="{$telephone}"/></td>
</tr>
<tr>
<td class="tl">邮箱</td>
<td class="tr"><input type="text" size="30" name="post[email]" id="email" value="{$email}"/></td>
</tr>
<tr>
<td class="tl">主页</td>
<td class="tr"><input type="text" size="40" name="post[homepage]" id="homepage" value="{$homepage}"/></td>
</tr>
{if $DT[im_qq]}
<tr>
<td class="tl">QQ</td>
<td class="tr"><input type="text" size="20" name="post[qq]" id="qq" value="{$qq}"/></td>
</tr>
{/if}
{if $DT[im_wx]}
<tr>
<td class="tl">微信</td>
<td class="tr"><input type="text" size="20" name="post[wx]" id="wx" value="{$wx}"/></td>
</tr>
{/if}
{if $DT[im_ali]}
<tr>
<td class="tl">旺旺</td>
<td class="tr"><input type="text" size="20" name="post[ali]" id="ali" value="{$ali}"/></td>
</tr>
{/if}
{if $DT[im_skype]}
<tr>
<td class="tl">Skype</td>
<td class="tr"><input type="text" size="20" name="post[skype]" id="skype" value="{$skype}"/></td>
</tr>
{/if}
<tr>
<td class="tl">备注</td>
<td class="tr"><input type="text" size="40" name="post[note]" id="note" value="{$note}"/></td>
</tr>
<tr>
<td class="tl">排序</td>
<td class="tr f_gray"><input type="text" size="3" name="post[listorder]" id="listorder" value="{$listorder}"/> 请填写数字，数字越大越靠前</td>
</tr>
</table>
<div class="sbt">
<input type="submit" name="submit" value="修 改" class="btn_g"/> &nbsp; &nbsp;<input type="button" value=" 取 消 " class="btn" onclick="history.back(-1);"/>
</div>
</form>
<script type="text/javascript">s('friend');m('s3');</script>
{elseif $action=='show'}
<table cellpadding="10" cellspacing="1" class="tb">
{if $user}
<tr>
<td class="tl">会员</td>
<td class="tr">
	<div class="list-img">
	<a href="{userurl($user[username], 'file=space')}" rel="external"><img src="{useravatar($user[username], 'large')}" width="48" height="48" class="avatar"/><i class="userinfo-v{$user[validate]}" title="{valid_name($user[validate])}"></i></a>
	<ul>
	<li>{if $DT[follow]}<span class="f_r">{numtoread($user[fans])}粉丝</span>{/if}<a href="{userurl($user[username], 'file=space')}" rel="external"><strong>{$user[passport]}</strong></a></li>
	<li><span>{if $user[sign]}{$user[sign]}{else}没有留下签名~~{/if}</span></li>
	</ul>
	</div>
</td>
</tr>
{/if}
<tr>
<td class="tl">联系</td>
<td class="tr">
{if $DT[im_web] && $MG[chat] && $fusername}{im_web($fusername)} &nbsp; {/if}
{if $MG[inbox_limit]>-1 && $fusername}<a href="javascript:;" onclick="Dwidget('message.php?action=send&touser={$fusername}', '发送信件');"><img src="{DT_STATIC}image/msg.gif" title="发送站内信" align="absmiddle"/></a> &nbsp; {/if}
{if $DT[im_qq] && $qq}{im_qq($qq)} &nbsp; {/if}
{if $DT[im_wx] && $wx}{im_wx($wx, $username)} &nbsp; {/if}
{if $DT[im_ali] && $ali}{im_ali($ali)} &nbsp; {/if}
{if $DT[im_skype] && $skype}{im_skype($skype)} &nbsp; {/if}
{if $email}<a href="mailto:{$email}"><img src="{DT_STATIC}image/email.gif" title="发送邮件 {$email}" align="absmiddle"/></a> &nbsp; {/if}
{if $homepage}<a href="{$url}" target="_blank"><img src="{DT_STATIC}image/homepage.gif" title="打开 {$homepage}" align="absmiddle"/></a> &nbsp; {/if}
</td>
</tr>
{if $typeid}
<tr>
<td class="tl">分类</td>
<td class="tr">{$TYPE[$typeid][typename]}</td>
</tr>
{/if}
<tr>
<td class="tl">别名</td>
<td class="tr">{$alias} &nbsp; <a href="?action=edit&itemid={$itemid}" title="修改"><img src="{DT_STATIC}member/ico-edit.png" width="16" height="16" align="absmiddle"/></a></td>
</tr>
{if $company} 
<tr>
<td class="tl">公司</td>
<td class="tr">{$company}</td>
</tr>
{/if}
{if $truename} 
<tr>
<td class="tl">姓名</td>
<td class="tr">{$truename} {if $career} ({$career}){/if}</td>
</tr>
{/if}
{if $mobile} 
<tr>
<td class="tl">手机</td>
<td class="tr">{$mobile}</td>
</tr>
{/if}
{if $telephone} 
<tr>
<td class="tl">电话</td>
<td class="tr">{$telephone}</td>
</tr>
{/if}
<tr>
<td class="tl">备注</td>
<td class="tr f_gray">{if $note}{$note}{else}暂无备注{/if}</td>
</tr>
</table>
<div class="sbt"><input type="button" value=" 确 定 " class="btn_g" onclick="Go('?action=index');"/></div>
<script type="text/javascript">s('friend');m('s3');</script>
{elseif $action=='list'}
<form action="?" id="search">
<input type="hidden" name="action" value="{$action}"/>
<div class="tt">
{$fields_select}&nbsp;
<input type="text" size="30" name="kw" value="{$kw}" title="关键词" placeholder="关键词"/>&nbsp;
{dcalendar('fromdate', $fromdate, '-', 1)} 至 {dcalendar('todate', $todate, '-', 1)}&nbsp;
<input type="submit" value=" 搜 索 " class="btn"/>&nbsp;
<input type="button" value=" 重 置 " class="btn" onclick="Go('?action={$action}');"/>
</div>
</form>
<form method="post">
<div class="ls">
<table cellpadding="10" cellspacing="0" class="tb">
<tr>
<th width="20"><input type="checkbox" onclick="checkall(this.form);" title="全选/反选"/></th>
<th width="60">头像</th>
<th>会员</th>
<th width="80">粉丝</th>
<th width="80" data-hide-1200="1" data-hide-1400="1">关注</th>
<th width="130">拉黑时间</th>
<th width="180">拉黑原因</th>
</tr>
{loop $lists $k $v}
<tr align="center">
<td><input type="checkbox" name="itemid[]" value="{$v[itemid]}"/></td>
<td><a href="{userurl($v[busername], 'file=space')}" target="_blank"><img src="{useravatar($v[busername])}" width="48" height="48" class="avatar"/></a><i class="userinfo-v{$v[member][validate]}" title="{valid_name($v[member][validate])}"></i></td>
<td align="left">
<a href="{userurl($v[busername], 'file=space')}" target="_blank">{$v[bpassport]}</a>
<div class="f_gray lh32" style="height:32px;overflow:hidden;">{if $v[member][sign]}{$v[member][sign]}{else}没有留下签名~~{/if}</div>
</td>
<td>{$v[member][fans]}</td>
<td data-hide-1200="1" data-hide-1400="1">{$v[member][follows]}</td>
<td class="f_gray c_p" onclick="Dq('date', this.title);" title="{$v[adddate]}">{timetoread($v[addtime], 5)}</td>
<td title="{$v[note]}"><input type="text" size="20" name="post[{$v[itemid]}][note]" value="{$v[note]}"/></td>
</tr>
{/loop}
</table>
<div class="btns">
<label><input type="checkbox" onclick="checkall(this.form);" title="全选/反选"/></label>
<input type="submit" value=" 更新原因 " class="btn_g" onclick="this.form.action='?action=reason'"/> &nbsp; &nbsp;
<input type="submit" value=" 取消拉黑 " class="btn_r" onclick="if(confirm('确定要将选中会员移出黑名单吗？')){this.form.action='?action=remove'}else{return false;}"/> &nbsp; &nbsp;
</div>
</form>
<div class="pages">{$pages}</div>
<script type="text/javascript">s('friend');m('list');</script>
{else}
<form action="?" id="search">
<div class="tt">
&nbsp;{$fields_select}&nbsp;
<input type="text" size="50" name="kw" value="{$kw}" title="关键词" placeholder="关键词"/>&nbsp;
{$type_select}&nbsp;
<input type="submit" value=" 搜 索 " class="btn"/>&nbsp;
<input type="button" value=" 重 搜 " class="btn" onclick="Go('?action=index');"/>
</div>
</form>

<form method="post">
<div class="ls">
<table cellpadding="10" cellspacing="0" class="tb">
<tr>
<th width="20"><input type="checkbox" onclick="checkall(this.form);" title="全选/反选"/></th>
<th width="130" data-hide-1200="1" data-hide-1400="1">分类</th>
<th width="60">头像</th>
<th>会员</th>
<th width="80">粉丝</th>
<th width="80" data-hide-1200="1">关注</th>
{if $MG[chat] && $DT[im_web]}<th width="80">聊天</th>{/if}
{if $MG[inbox_limit]>-1}<th width="80">私信</th>{/if}
<th width="180">备注</th>
<th width="40">修改</th>
</tr>
{loop $lists $k $v}
<tr align="center">
<td><input type="checkbox" name="itemid[]" value="{$v[itemid]}"/></td>
<td data-hide-1200="1" data-hide-1400="1"><a href="javascript:;" onclick="Dq('typeid', {$v[typeid]});">{$v[type]}</a></td>
<td><a href="{userurl($v[fusername], 'file=space')}" target="_blank"><img src="{useravatar($v[fusername])}" width="48" height="48" class="avatar"/></a><i class="userinfo-v{$v[member][validate]}" title="{valid_name($v[member][validate])}"></i></td>
<td align="left">
<a href="?action=show&itemid={$v[itemid]}">{if $v[alias]}{$v[alias]}{else}{$v[fpassport]}{/if}</a>
<div class="f_gray lh32" style="height:32px;overflow:hidden;">{if $v[member][sign]}{$v[member][sign]}{else}没有留下签名~~{/if}</div>
</td>
<td>{$v[member][fans]}</td>
<td data-hide-1200="1" data-hide-1400="1">{$v[member][follows]}</td>
{if $MG[chat] && $DT[im_web]}<td>{im_web($v[fusername])}</td>{/if}
{if $MG[inbox_limit]>-1}<td><a href="javascript:;" onclick="Dwidget('message.php?action=send&touser={$v[fusername]}', '发送信件');"><img src="{DT_STATIC}image/msg.gif" title="发送站内信" align="absmiddle"/></a></td>{/if}
<td title="{$v[note]}"><input type="text" size="20" name="post[{$v[itemid]}][note]" value="{$v[note]}"/></td>
<td><a href="?action=edit&itemid={$v[itemid]}"><img width="16" height="16" src="{DT_STATIC}member/edit.png" title="修改" alt=""/></a></td>
</tr>
{/loop}
</table>
<div class="btns">
<label><input type="checkbox" onclick="checkall(this.form);" title="全选/反选"/></label>
<input type="submit" value=" 更新备注 " class="btn_g" onclick="this.form.action='?action=note'"/> &nbsp; &nbsp;
<input type="submit" value=" 删除好友 " class="btn_r" onclick="if(confirm('确定要删除选中好友吗？')){this.form.action='?action=delete'}else{return false;}"/> &nbsp; &nbsp;
<input type="submit" value=" 拉黑好友 " class="btn_r" onclick="if(confirm('确定要删除选中好友并拉黑吗？')){this.form.action='?action=delete&job=black'}else{return false;}"/> &nbsp; &nbsp;
</div>
</form>

{if $MG[friend_limit]}
<div class="limit">好友上限 <span class="f_b f_red">{$MG[friend_limit]}</span> 人&nbsp;&nbsp;&nbsp;当前已加 <span class="f_b">{$limit_used}</span> 人&nbsp;&nbsp;&nbsp;还可以加 <span class="f_b f_blue">{$limit_free}</span> 人</div>
{/if}
<div class="pages">{$pages}</div>
<script type="text/javascript">s('friend');m('s3');</script>
{/if}
{template 'footer', 'member'}